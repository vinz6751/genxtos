/* This is standalone and raw logger for the A2560X/K/GenX channel A
 * It is meant to be standalone and pretty raw so to minimize chances of failing, as it is used for debugging. */


#if defined(MACHINE_A2560K) || defined(MACHINE_A2560X) || defined(MACHINE_GENX)

#include <stdint.h>
/*#include "string.h"*/
#include "foenix.h"
#include "vicky2.h"
#include "vicky2_txt_a_logger.h"

#define VICKY3_A_BASE ((uint8_t*)0xFEC40000L)


static const unsigned char MSX_CP437_8x8_bin[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x81, 0xa5, 0x81,
  0xbd, 0x99, 0x81, 0x7e, 0x7e, 0xff, 0xdb, 0xff, 0xff, 0xc3, 0xe7, 0x7e,
  0x00, 0x6c, 0xfe, 0xfe, 0x7c, 0x38, 0x10, 0x00, 0x10, 0x38, 0x7c, 0xfe,
  0x7c, 0x38, 0x10, 0x00, 0x38, 0x38, 0xfe, 0xfe, 0x54, 0x10, 0x7c, 0x00,
  0x10, 0x38, 0x7c, 0xfe, 0xfe, 0x38, 0x7c, 0x00, 0x00, 0x00, 0x18, 0x3c,
  0x3c, 0x18, 0x00, 0x00, 0xff, 0xff, 0xe7, 0xc3, 0xc3, 0xe7, 0xff, 0xff,
  0x00, 0x18, 0x24, 0x42, 0x42, 0x24, 0x18, 0x00, 0xff, 0xe7, 0xdb, 0xbd,
  0xbd, 0xdb, 0xe7, 0xff, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f, 0xff,
  0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x80, 0x30, 0x28, 0x24, 0x24,
  0x28, 0x20, 0xe0, 0xc0, 0x3c, 0x24, 0x3c, 0x24, 0x24, 0xe4, 0xdc, 0x18,
  0x10, 0x54, 0x28, 0xc6, 0x28, 0x54, 0x10, 0x00, 0x20, 0x30, 0x38, 0x3c,
  0x38, 0x30, 0x20, 0x00, 0x04, 0x0c, 0x1c, 0x3c, 0x1c, 0x0c, 0x04, 0x00,
  0x10, 0x38, 0x7c, 0x10, 0x10, 0x7c, 0x38, 0x10, 0x48, 0x48, 0x48, 0x48,
  0x48, 0x00, 0x48, 0x00, 0x3e, 0x4a, 0x4a, 0x3a, 0x0a, 0x0a, 0x0a, 0x00,
  0x1c, 0x20, 0x18, 0x24, 0x24, 0x18, 0x04, 0x38, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x7e, 0x7e, 0x00, 0x10, 0x38, 0x7c, 0x10, 0x7c, 0x38, 0x10, 0xff,
  0x10, 0x38, 0x54, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10,
  0x10, 0x54, 0x38, 0x10, 0x00, 0x20, 0x40, 0xff, 0x40, 0x20, 0x00, 0x00,
  0x00, 0x04, 0x02, 0xff, 0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40,
  0x7c, 0x00, 0x00, 0x00, 0x00, 0x24, 0x42, 0xff, 0x42, 0x24, 0x00, 0x00,
  0x00, 0x10, 0x38, 0x7c, 0xfe, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x7c, 0x38,
  0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x10, 0x00, 0x28, 0x28, 0x28, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x28, 0x28, 0x7c, 0x28, 0x7c, 0x28, 0x28, 0x00,
  0x10, 0x3c, 0x50, 0x38, 0x14, 0x78, 0x10, 0x00, 0x60, 0x64, 0x08, 0x10,
  0x20, 0x4c, 0x0c, 0x00, 0x20, 0x50, 0x50, 0x20, 0x54, 0x48, 0x34, 0x00,
  0x08, 0x10, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x20, 0x40, 0x40,
  0x40, 0x20, 0x10, 0x00, 0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x00,
  0x10, 0x54, 0x38, 0x10, 0x38, 0x54, 0x10, 0x00, 0x00, 0x10, 0x10, 0x7c,
  0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x20, 0x00,
  0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x04, 0x08, 0x10, 0x20, 0x40, 0x00,
  0x38, 0x44, 0x44, 0x54, 0x44, 0x44, 0x38, 0x00, 0x10, 0x30, 0x50, 0x10,
  0x10, 0x10, 0x7c, 0x00, 0x38, 0x44, 0x04, 0x08, 0x30, 0x40, 0x7c, 0x00,
  0x38, 0x44, 0x04, 0x18, 0x04, 0x44, 0x38, 0x00, 0x08, 0x18, 0x28, 0x48,
  0x7c, 0x08, 0x08, 0x00, 0x7c, 0x40, 0x70, 0x08, 0x04, 0x08, 0x70, 0x00,
  0x18, 0x20, 0x40, 0x78, 0x44, 0x44, 0x38, 0x00, 0x7c, 0x44, 0x08, 0x10,
  0x10, 0x10, 0x10, 0x00, 0x38, 0x44, 0x44, 0x38, 0x44, 0x44, 0x38, 0x00,
  0x38, 0x44, 0x44, 0x3c, 0x04, 0x08, 0x30, 0x00, 0x00, 0x00, 0x10, 0x00,
  0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x10, 0x20, 0x00,
  0x0c, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0c, 0x00, 0x00, 0x00, 0x7c, 0x00,
  0x00, 0x7c, 0x00, 0x00, 0x60, 0x30, 0x18, 0x0c, 0x18, 0x30, 0x60, 0x00,
  0x38, 0x44, 0x04, 0x08, 0x10, 0x00, 0x10, 0x00, 0x38, 0x44, 0x04, 0x34,
  0x54, 0x54, 0x38, 0x00, 0x10, 0x28, 0x44, 0x44, 0x7c, 0x44, 0x44, 0x00,
  0x78, 0x24, 0x24, 0x38, 0x24, 0x24, 0x78, 0x00, 0x18, 0x24, 0x40, 0x40,
  0x40, 0x24, 0x18, 0x00, 0x70, 0x28, 0x24, 0x24, 0x24, 0x28, 0x70, 0x00,
  0x7c, 0x40, 0x40, 0x78, 0x40, 0x40, 0x7c, 0x00, 0x7c, 0x40, 0x40, 0x78,
  0x40, 0x40, 0x40, 0x00, 0x38, 0x44, 0x40, 0x5c, 0x44, 0x44, 0x38, 0x00,
  0x44, 0x44, 0x44, 0x7c, 0x44, 0x44, 0x44, 0x00, 0x38, 0x10, 0x10, 0x10,
  0x10, 0x10, 0x38, 0x00, 0x1c, 0x08, 0x08, 0x08, 0x48, 0x48, 0x30, 0x00,
  0x44, 0x48, 0x50, 0x60, 0x50, 0x48, 0x44, 0x00, 0x40, 0x40, 0x40, 0x40,
  0x40, 0x40, 0x7c, 0x00, 0x44, 0x6c, 0x54, 0x54, 0x44, 0x44, 0x44, 0x00,
  0x44, 0x44, 0x64, 0x54, 0x4c, 0x44, 0x44, 0x00, 0x38, 0x44, 0x44, 0x44,
  0x44, 0x44, 0x38, 0x00, 0x78, 0x44, 0x44, 0x78, 0x40, 0x40, 0x40, 0x00,
  0x38, 0x44, 0x44, 0x44, 0x54, 0x48, 0x34, 0x00, 0x78, 0x44, 0x44, 0x78,
  0x50, 0x48, 0x44, 0x00, 0x38, 0x44, 0x40, 0x38, 0x04, 0x44, 0x38, 0x00,
  0x7c, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x44, 0x44, 0x44, 0x44,
  0x44, 0x44, 0x38, 0x00, 0x44, 0x44, 0x44, 0x44, 0x44, 0x28, 0x10, 0x00,
  0x44, 0x44, 0x44, 0x54, 0x54, 0x6c, 0x44, 0x00, 0x44, 0x44, 0x28, 0x10,
  0x28, 0x44, 0x44, 0x00, 0x44, 0x44, 0x44, 0x38, 0x10, 0x10, 0x10, 0x00,
  0x7c, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7c, 0x00, 0x3c, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x3c, 0x00, 0x00, 0x40, 0x20, 0x10, 0x08, 0x04, 0x00, 0x00,
  0x3c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x00, 0x10, 0x28, 0x44, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x00,
  0x20, 0x10, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x04,
  0x3c, 0x44, 0x3c, 0x00, 0x40, 0x40, 0x58, 0x64, 0x44, 0x64, 0x58, 0x00,
  0x00, 0x00, 0x38, 0x44, 0x40, 0x44, 0x38, 0x00, 0x04, 0x04, 0x34, 0x4c,
  0x44, 0x4c, 0x34, 0x00, 0x00, 0x00, 0x38, 0x44, 0x7c, 0x40, 0x38, 0x00,
  0x18, 0x24, 0x20, 0x78, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0x38, 0x44,
  0x44, 0x3c, 0x04, 0x38, 0x40, 0x40, 0x78, 0x44, 0x44, 0x44, 0x44, 0x00,
  0x00, 0x10, 0x00, 0x30, 0x10, 0x10, 0x38, 0x00, 0x00, 0x08, 0x00, 0x18,
  0x08, 0x08, 0x48, 0x30, 0x40, 0x40, 0x48, 0x50, 0x60, 0x50, 0x48, 0x00,
  0x30, 0x10, 0x10, 0x10, 0x10, 0x10, 0x38, 0x00, 0x00, 0x00, 0x68, 0x54,
  0x54, 0x54, 0x54, 0x00, 0x00, 0x00, 0x58, 0x64, 0x44, 0x44, 0x44, 0x00,
  0x00, 0x00, 0x38, 0x44, 0x44, 0x44, 0x38, 0x00, 0x00, 0x00, 0x58, 0x64,
  0x64, 0x58, 0x40, 0x40, 0x00, 0x00, 0x34, 0x4c, 0x4c, 0x34, 0x04, 0x04,
  0x00, 0x00, 0x58, 0x64, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0x3c, 0x40,
  0x38, 0x04, 0x78, 0x00, 0x20, 0x20, 0x78, 0x20, 0x20, 0x24, 0x18, 0x00,
  0x00, 0x00, 0x48, 0x48, 0x48, 0x48, 0x34, 0x00, 0x00, 0x00, 0x44, 0x44,
  0x44, 0x28, 0x10, 0x00, 0x00, 0x00, 0x44, 0x44, 0x54, 0x54, 0x28, 0x00,
  0x00, 0x00, 0x44, 0x28, 0x10, 0x28, 0x44, 0x00, 0x00, 0x00, 0x44, 0x44,
  0x4c, 0x34, 0x04, 0x38, 0x00, 0x00, 0x7c, 0x08, 0x10, 0x20, 0x7c, 0x00,
  0x0c, 0x10, 0x10, 0x20, 0x10, 0x10, 0x0c, 0x00, 0x10, 0x10, 0x10, 0x00,
  0x10, 0x10, 0x10, 0x00, 0x30, 0x08, 0x08, 0x04, 0x08, 0x08, 0x30, 0x00,
  0x20, 0x54, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x7c, 0x7c, 0x7c,
  0x7c, 0x7c, 0x7c, 0x00, 0x18, 0x24, 0x40, 0x40, 0x24, 0x18, 0x08, 0x30,
  0x48, 0x00, 0x48, 0x48, 0x48, 0x48, 0x34, 0x00, 0x08, 0x10, 0x38, 0x44,
  0x7c, 0x40, 0x38, 0x00, 0x10, 0x28, 0x38, 0x04, 0x3c, 0x44, 0x3c, 0x00,
  0x28, 0x00, 0x38, 0x04, 0x3c, 0x44, 0x3c, 0x00, 0x20, 0x10, 0x38, 0x04,
  0x3c, 0x44, 0x3c, 0x00, 0x38, 0x28, 0x38, 0x04, 0x3c, 0x44, 0x3c, 0x00,
  0x00, 0x38, 0x44, 0x40, 0x44, 0x38, 0x10, 0x30, 0x10, 0x28, 0x38, 0x44,
  0x7c, 0x40, 0x38, 0x00, 0x28, 0x00, 0x38, 0x44, 0x7c, 0x40, 0x38, 0x00,
  0x20, 0x10, 0x38, 0x44, 0x7c, 0x40, 0x38, 0x00, 0x28, 0x00, 0x00, 0x30,
  0x10, 0x10, 0x38, 0x00, 0x10, 0x28, 0x00, 0x30, 0x10, 0x10, 0x38, 0x00,
  0x20, 0x10, 0x00, 0x30, 0x10, 0x10, 0x38, 0x00, 0x28, 0x00, 0x10, 0x28,
  0x44, 0x7c, 0x44, 0x00, 0x10, 0x28, 0x10, 0x28, 0x44, 0x7c, 0x44, 0x00,
  0x08, 0x10, 0x7c, 0x40, 0x78, 0x40, 0x7c, 0x00, 0x00, 0x00, 0x6e, 0x10,
  0x7c, 0x90, 0x6e, 0x00, 0x3e, 0x50, 0x90, 0xfc, 0x90, 0x90, 0x9e, 0x00,
  0x10, 0x28, 0x38, 0x44, 0x44, 0x44, 0x38, 0x00, 0x28, 0x00, 0x38, 0x44,
  0x44, 0x44, 0x38, 0x00, 0x20, 0x10, 0x38, 0x44, 0x44, 0x44, 0x38, 0x00,
  0x10, 0x28, 0x00, 0x48, 0x48, 0x48, 0x34, 0x00, 0x20, 0x10, 0x00, 0x48,
  0x48, 0x48, 0x34, 0x00, 0x28, 0x00, 0x44, 0x44, 0x4c, 0x34, 0x04, 0x38,
  0x28, 0x38, 0x44, 0x44, 0x44, 0x44, 0x38, 0x00, 0x28, 0x00, 0x44, 0x44,
  0x44, 0x44, 0x38, 0x00, 0x00, 0x10, 0x38, 0x54, 0x50, 0x54, 0x38, 0x10,
  0x18, 0x24, 0x20, 0x78, 0x20, 0x22, 0x7c, 0x00, 0x44, 0x44, 0x28, 0x7c,
  0x10, 0x7c, 0x10, 0x00, 0x38, 0x44, 0xf0, 0x40, 0xf0, 0x44, 0x38, 0x00,
  0x18, 0x24, 0x20, 0x70, 0x20, 0x20, 0x20, 0xc0, 0x08, 0x10, 0x38, 0x04,
  0x3c, 0x44, 0x3c, 0x00, 0x10, 0x20, 0x00, 0x30, 0x10, 0x10, 0x38, 0x00,
  0x08, 0x10, 0x38, 0x44, 0x44, 0x44, 0x38, 0x00, 0x10, 0x20, 0x00, 0x48,
  0x48, 0x48, 0x34, 0x00, 0x28, 0x50, 0x00, 0x58, 0x64, 0x44, 0x44, 0x00,
  0x14, 0x28, 0x44, 0x64, 0x54, 0x4c, 0x44, 0x00, 0x30, 0x08, 0x38, 0x48,
  0x38, 0x00, 0x00, 0x00, 0x10, 0x28, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x10, 0x00, 0x10, 0x20, 0x40, 0x44, 0x38, 0x00, 0x00, 0x00, 0x00, 0x7c,
  0x40, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x04, 0x04, 0x00, 0x00,
  0x42, 0x44, 0x4e, 0x52, 0x2e, 0x48, 0x8e, 0x00, 0x42, 0x44, 0x4a, 0x5a,
  0x2e, 0x42, 0x82, 0x00, 0x10, 0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00,
  0x00, 0x12, 0x24, 0x48, 0x24, 0x12, 0x00, 0x00, 0x00, 0x90, 0x48, 0x24,
  0x48, 0x90, 0x00, 0x00, 0x88, 0x22, 0x88, 0x22, 0x88, 0x22, 0x88, 0x22,
  0xcc, 0x33, 0xcc, 0x33, 0xcc, 0x33, 0xcc, 0x33, 0xee, 0xbb, 0xee, 0xbb,
  0xee, 0xbb, 0xee, 0xbb, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10,
  0x10, 0x10, 0x10, 0xf0, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xf0, 0x10,
  0xf0, 0x10, 0x10, 0x10, 0x28, 0x28, 0x28, 0xe8, 0x28, 0x28, 0x28, 0x28,
  0x00, 0x00, 0x00, 0xf8, 0x28, 0x28, 0x28, 0x28, 0x00, 0x00, 0xf0, 0x10,
  0xf0, 0x10, 0x10, 0x10, 0x28, 0x28, 0xe8, 0x08, 0xe8, 0x28, 0x28, 0x28,
  0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x00, 0x00, 0xf8, 0x08,
  0xe8, 0x28, 0x28, 0x28, 0x28, 0x28, 0xe8, 0x08, 0xf8, 0x00, 0x00, 0x00,
  0x28, 0x28, 0x28, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0xf0, 0x10,
  0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x10, 0x10, 0x10, 0x10,
  0x10, 0x10, 0x10, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0xff,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10, 0x10, 0x10,
  0x10, 0x10, 0x10, 0x1f, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00, 0x00, 0xff,
  0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0xff, 0x10, 0x10, 0x10, 0x10,
  0x10, 0x10, 0x1f, 0x10, 0x1f, 0x10, 0x10, 0x10, 0x28, 0x28, 0x28, 0x2f,
  0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x2f, 0x20, 0x3f, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x3f, 0x20, 0x2f, 0x28, 0x28, 0x28, 0x28, 0x28, 0xef, 0x00,
  0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0xef, 0x28, 0x28, 0x28,
  0x28, 0x28, 0x2f, 0x20, 0x2f, 0x28, 0x28, 0x28, 0x00, 0x00, 0xff, 0x00,
  0xff, 0x00, 0x00, 0x00, 0x28, 0x28, 0xef, 0x00, 0xef, 0x28, 0x28, 0x28,
  0x10, 0x10, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x28, 0x28, 0x28, 0xff,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff, 0x10, 0x10, 0x10,
  0x00, 0x00, 0x00, 0xff, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x3f,
  0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x1f, 0x10, 0x1f, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x1f, 0x10, 0x1f, 0x10, 0x10, 0x10, 0x00, 0x00, 0x00, 0x3f,
  0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0x28, 0xff, 0x28, 0x28, 0x28, 0x28,
  0x10, 0x10, 0xff, 0x10, 0xff, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xf0,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x10, 0x10, 0x10, 0x10,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00,
  0xff, 0xff, 0xff, 0xff, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xff, 0xff, 0xff, 0xff,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x48, 0x48, 0x48, 0x34, 0x00,
  0x00, 0x00, 0x38, 0x44, 0x78, 0x44, 0x78, 0x40, 0x7c, 0x40, 0x40, 0x40,
  0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0x7e, 0x24, 0x24, 0x24, 0x24, 0x00,
  0x7c, 0x40, 0x20, 0x10, 0x20, 0x40, 0x7c, 0x00, 0x00, 0x00, 0x3e, 0x44,
  0x44, 0x44, 0x38, 0x00, 0x00, 0x00, 0x48, 0x48, 0x48, 0x48, 0x70, 0x80,
  0x00, 0x00, 0x34, 0x58, 0x10, 0x10, 0x10, 0x00, 0x7c, 0x10, 0x28, 0x44,
  0x28, 0x10, 0x7c, 0x00, 0x38, 0x44, 0x44, 0x7c, 0x44, 0x44, 0x38, 0x00,
  0x38, 0x44, 0x44, 0x44, 0x28, 0x28, 0x6c, 0x00, 0x3c, 0x20, 0x18, 0x44,
  0x44, 0x44, 0x38, 0x00, 0x00, 0x00, 0x6c, 0x92, 0x92, 0x6c, 0x00, 0x00,
  0x00, 0x24, 0x4a, 0x52, 0x22, 0x5c, 0x40, 0x00, 0x00, 0x00, 0x3c, 0x40,
  0x38, 0x40, 0x3c, 0x00, 0x38, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x00,
  0x00, 0x7c, 0x00, 0x7c, 0x00, 0x7c, 0x00, 0x00, 0x10, 0x10, 0x7c, 0x10,
  0x10, 0x7c, 0x00, 0x00, 0x20, 0x10, 0x08, 0x10, 0x20, 0x00, 0x38, 0x00,
  0x08, 0x10, 0x20, 0x10, 0x08, 0x00, 0x38, 0x00, 0x0c, 0x12, 0x10, 0x10,
  0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x90, 0x60,
  0x00, 0x10, 0x00, 0x7c, 0x00, 0x10, 0x00, 0x00, 0x00, 0x20, 0x54, 0x08,
  0x20, 0x54, 0x08, 0x00, 0x00, 0x10, 0x28, 0x10, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10,
  0x00, 0x00, 0x00, 0x00, 0x1e, 0x10, 0x10, 0x10, 0x10, 0x90, 0x50, 0x20,
  0x00, 0x38, 0x24, 0x24, 0x24, 0x00, 0x00, 0x00, 0x38, 0x04, 0x1c, 0x20,
  0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x3c, 0x3c, 0x3c, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


struct vicky3_t {
    uint32_t control;
    uint32_t border_control;
    uint32_t border_color;
    uint32_t background_color;
    uint32_t cursor_control;
    uint32_t cursor_position;
    uint32_t line_interrupt_01;
    uint32_t line_interrupt_23;
    uint32_t font_size_control;
    uint32_t font_count_control;
    uint32_t reserved_0028[6];
    uint32_t mouse_graphics[16*16*2];
    uint16_t mouse_control; /* Must write as 32bits ! */
    uint16_t reserved_c02;
    uint32_t mouse_position; /* Read only */
    uint16_t reserved_c06;
    uint32_t ps2_byte[3]; /* Must write as 32 bits. See doc. */
};

struct vicky3_text_memory_t {
    char     display[0x4000];
    uint8_t  notmapped_4000[0x4000];
    uint8_t  color[0x4000];
    uint8_t  nomapped_c000[0x400];
    uint32_t palette_fg[16];
    uint32_t palette_bg[16];
};

static volatile struct vicky3_t * const vicky3_a_ctrl = (struct vicky3_t*)VICKY3_A_BASE;
static uint8_t * const font_memory = VICKY3_A_BASE + 0x8000;
static struct vicky3_text_memory_t * const text_memory = (struct vicky3_text_memory_t*)(VICKY3_A_BASE + 0x20000);

static void scroll(void);

#define COL_COUNT (1024/8)
#define LINE_COUNT (768/8)

static uint8_t fgbg_color;

void channel_A_logger_init(void)
{
    int i;
    struct vicky2_channel_t *vicky = &vicky2_channel_a;

    vicky2_init_channel(vicky);
#if 1
    /* Initialise text screen for logging */
    vicky->ctrl->control = VICKY_CTRL_TEXT; /* Default is 800x600 */
    /*vicky->ctrl->background_color = 0xff8888ff;*/
    /*vicky->ctrl->border_control = 0x00080800| VICKY_BORDER_ENABLE;*/
    /*vicky->ctrl->border_color = 0xffffffff;*/
    /*vicky->ctrl->background_color = 0x00111111;*/ /*convert_atari2vicky_color(tt_dflt_palette[15]);*/
    /*vicky->ctrl->cursor_control = 0xf0ff0001;*/
    /*vicky->ctrl->cursor_position = 0x00000000;*/
    vicky->ctrl->font_size_control = 0x08080808; /* 8x8 character */
    vicky->ctrl->font_count_control = (LINE_COUNT & 0xff) << 8 | (COL_COUNT & 0xff);
#endif
    channel_A_set_fg_color(0);
    channel_A_set_bg_color(15);
    channel_A_cls();
    for (i=0; i<16; i++) {
        vicky2_channel_a.text_memory->palette_bg[i].code = vicky2_channel_a.text_memory->palette_fg[i].code = convert_atari2vicky_color(vicky2_default_palette[i]);
    }

#if 0
    vicky3_a_ctrl->control = 0x001; /* Text enable, enable video, 800x600, no gamma */
    vicky3_a_ctrl->border_color = 0; /* No border */
    vicky3_a_ctrl->background_color = 0x00110033UL; /* xxRGB */
    vicky3_a_ctrl->cursor_control =  0x027F0007UL;
    vicky3_a_ctrl->font_size_control = 0x08080808;
    vicky3_a_ctrl->font_count_control = (LINE_COUNT<<8) | COL_COUNT;
#endif
    /* Load font */
    for (i=0; i<sizeof(MSX_CP437_8x8_bin); i++)
        vicky->font_memory->mem[i] = MSX_CP437_8x8_bin[i];

    /* Setup colors */
    vicky->text_memory->palette_fg[0].code = 0x00000000L; /*vicky3_a_ctrl->background_color;*/
    vicky->text_memory->palette_fg[1].code = 0x00ffffffL; /* White */
    vicky->text_memory->palette_fg[2].code = 0x00ff0000L; /* Used for cursor color */
}


void channel_A_cls(void)
{
    int i;

    /* Clear screen */
    for (i=0; i<COL_COUNT*LINE_COUNT; i++)
    {
        text_memory->display[i] = 0;
        text_memory->color[i] = fgbg_color;
    }
}

void channel_A_write(const char *c)
{
    uint32_t x,y;

    x = y = vicky3_a_ctrl->cursor_position;
    x &= 0xffff;
    y = (y >> 16);
    
    while (c && *c)
    {
        if (*c == '\r')
        {
            x = 0;
        }
        else if (*c == '\n')
        {
            if (y == LINE_COUNT-1)
                scroll();
            else
                y++;
            x = 0; /* Assume we intend that \n = \r\n */
        }
        else
        {
            text_memory->display[COL_COUNT*y + x] = *c;
            text_memory->color[COL_COUNT*y + x] = fgbg_color;

            if (++x == COL_COUNT)
            {
                /* Wrap and scroll if needed */
                if (y == LINE_COUNT-1)
                    scroll();
                else
                    y++;
                x = 0;
            }
        }

        channel_A_set_cursor_pos(x, y);

        c++;
    }
}


void channel_A_set_cursor_pos(uint16_t x, uint16_t y) {
    vicky3_a_ctrl->cursor_position = (((uint32_t)y) << 16) | x;
}


void channel_A_set_fg_color(uint8_t c)
{
    fgbg_color &= 0x00ff;
    fgbg_color |= c << 4;
}


void channel_A_set_bg_color(uint8_t c)
{
    fgbg_color &= 0xff00;
    fgbg_color |= c;
}


static void scroll(void)
{
#define COPY_BYTE_BY_BYTE
#ifdef COPY_BYTE_BY_BYTE
    int i;

    char *src = &text_memory->display[1*COL_COUNT];
    char *dst = &text_memory->display[0];
    for (i=0 ; i<((LINE_COUNT-1)*COL_COUNT)/4; i++)
    {
        *dst++ = *src++;
        *dst++ = *src++;
        *dst++ = *src++;
        *dst++ = *src++;
    }
    for (i=0; i < COL_COUNT/4; i++)
    {
        *dst++ = ' ';
        *dst++ = ' ';
        *dst++ = ' ';
        *dst++ = ' ';
    }
#else
    /* This doesn't work because it uses 16/32 byte writes */
    memcpy(&text_memory->display[COL_COUNT], &text_memory->display[0], COL_COUNT*LINE_COUNT-1);
    memset(&text_memory->display[COL_COUNT*LINE_COUNT-1], COL_COUNT, 0); /* VBCC doesn't know bzero */
#endif    
    /* If we used background colours we would have to scroll them as well, but we don't. */
}

#endif
